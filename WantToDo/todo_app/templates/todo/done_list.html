{% extends 'todo/base.html' %}
{% load static %}
{% load todo_extras %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'todo/home.css' %}">

<style>
/* done_list.html 専用：スマホ時のみ
   1行目：タイトル
   2行目：完了バッジ（単独）
   3行目：カテゴリ */
@media screen and (max-width: 768px) {

  /* ===== カード全体 ===== */
  .todo-item {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 14px 16px;
    border: 1px solid #ddd;
    border-radius: 10px;
    background: #fff;
    margin: 0 auto 14px;
    width: 95%;
    max-width: 700px;
    box-sizing: border-box;
  }

  /* ===== 1行目：タイトル ===== */
  .todo-title {
    font-size: 1.1rem;
    font-weight: 700;
    text-align: left;
    margin-bottom: 4px;
    word-break: break-word;
    width: 100%;
  }

  /* ===== 2行目：完了バッジ（単独行） ===== */
  .done-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    align-self: flex-start; /* ✅ 左寄せ配置 */
    line-height: 1.1;
    white-space: nowrap;
    padding: 2px 8px;
    font-size: 0.8rem;
    border-radius: 999px;
    background: #e8f5e9;
    color: #2e7d32;
    border: 1px solid #c8e6c9;
    margin-bottom: 4px; /* タイトルとカテゴリの間に適度な余白 */
  }

  /* ===== 3行目：カテゴリ ===== */
  .todo-cat {
    display: block;
    color: #555;
    font-size: 0.95rem;
  }

  /* 難易度バッジは非表示 */
  .badge-diff {
    display: none !important;
  }

  /* 完了バッジを完全に左端に寄せる */
  .done-badge {
    margin-left: 0 !important;       /* ✅ 左余白を強制リセット */
    padding-left: 6px !important;    /* ✅ 最小限の内側余白だけ確保 */
  }

  /* もし親が中央寄せ気味の場合に備えて */
  .todo-main,
  .todo-item {
    align-items: flex-start !important; /* ✅ 左揃えを強制 */
  }
}

  /* ===== PC・タブレット時 (768px以上) ===== */
@media screen and (min-width: 769px) {

  /* ===== カード全体 ===== */
  .todo-item {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 14px 16px;
    border: 1px solid #ddd;
    border-radius: 10px;
    background: #fff;
    margin: 0 auto 14px;
    width: 100%;
    max-width: 700px;
    box-sizing: border-box;
  }

  /* ===== 1行目：タイトル ===== */
  .todo-title {
    font-size: 1.1rem;
    font-weight: 700;
    text-align: left;
    margin-bottom: 6px;
    word-break: break-word;
    width: 100%;
  }

  /* ===== 2行目：完了バッジ（独立flex行） ===== */
  .done-row {
    display: flex;
    justify-content: flex-start;  /* ✅ 左寄せ（中央や右にしたければここで変更） */
    align-items: center;
    width: 100%;
    margin-bottom: 6px;
  }

  .done-row .done-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 0.8rem;
    background: #e8f5e9;
    color: #2e7d32;
    border: 1px solid #c8e6c9;
    white-space: nowrap;
    line-height: 1.1;
  }

  /* ===== 3行目：難易度＋カテゴリ ===== */
  .todo-sub {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    flex-wrap: wrap;
    gap: 8px;
    width: 100%;
    text-align: left;
  }

  .badge-diff {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 0.8rem;
  }
  .badge-diff.high { background: #e74c3c; color: #fff; }
  .badge-diff.medium { background: #f1c40f; color: #333; }
  .badge-diff.low { background: #3498db; color: #fff; }

  .todo-cat {
    display: inline-block;
    font-size: 0.95rem;
    color: #555;
  }
}
</style>

{% endblock %}

{% block content %}
  <div class="filter-box" style="max-width:900px;">
    <h3 style="text-align:center; margin-bottom:16px;">完了済みWantToDo</h3>

    {% if wants %}
      <ul class="todo-list">
        {% for w in wants %}
          {# 難易度ごとに背景色を変える #}
          <li class="todo-item {{ w.difficulty|diff_row_class }}">
            <div class="todo-main position-relative">
              {# 行全体クリックで詳細ページへ遷移 #}
              <a href="{% url 'todo_app:done_detail' w.id %}" class="stretched-link" aria-label="詳細へ"></a>

              <div class="todo-title">
                {{ w.title }}
                </div>

              <div class="done-row">
                <span class="done-badge">
                  {% if w.completed_at %}
                    {{ w.completed_at|date:"n/j" }} 完了
                  {% else %}
                    完了
                  {% endif %}
                </span>
              </div>


              <div class="todo-sub">
                <span class="badge-diff
                  {% if w.difficulty == 'high' %}high
                  {% elif w.difficulty == 'medium' %}medium
                  {% else %}low{% endif %}
                ">{{ w.get_difficulty_display }}</span>


                {% if w.category %}
                  <span class="todo-cat"> / {{ w.get_category_display }}</span>
                {% endif %}
              </div>

              {% if w.memo %}
                <div class="todo-memo">{{ w.memo }}</div>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      </ul>

      {# ページネーション #}
      {% if page_obj.paginator.num_pages > 1 %}
      <div class="pagination-center">
        <nav aria-label="pagination">
          <ul class="pagination">
            {% if page_obj.has_previous %}
              <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">前へ</a></li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">前へ</span></li>
            {% endif %}

            <li class="page-item disabled">
              <span class="page-link">{{ page_obj.number }}/{{ page_obj.paginator.num_pages }}</span>
            </li>

            {% if page_obj.has_next %}
              <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">次へ</a></li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">次へ</span></li>
            {% endif %}
          </ul>
        </nav>
      </div>
      {% endif %}

    {% else %}
      <p class="signup-help" style="text-align:center">完了済みの WantToDo はありません。</p>
    {% endif %}

  <div class="bottom-button">
    <a href="{% url 'todo_app:incomplete_list' %}" class="btn btn-gray">未完了Want To Do一覧へ</a>
  </div>

  </div>


{% endblock %}
