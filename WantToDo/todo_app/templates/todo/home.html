{% extends 'todo/base.html' %}
{% load static %}
{% load todo_extras %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'todo/home.css' %}">
{% endblock %}

{% block content %}
<div class="filter-box">
  <form method="get" class="filter-form">
    <div class="filter-row">
      <div class="filter-field">
        <div class="filter-label">カテゴリ</div>
        {{ form.category }}
      </div>
      <div class="filter-field">
        <div class="filter-label">難易度</div>
        {{ form.difficulty }}
      </div>
    </div>

    <div class="filter-row">
      <div class="filter-field period-field">
        <div class="filter-label">期間</div>
        <div class="period-range">
          {{ form.start_date }} <span class="tilde">〜</span> {{ form.end_date }}
        </div>
      </div>
    </div>

    <div class="filter-actions">
      <button type="submit" class="btn btn-secondary filter-btn">絞り込み</button>
    </div>
  </form>
</div>

<div class="action-buttons">
  <a href="{% url 'todo_app:add_want' %}" class="btn btn-secondary add-btn">新たなWantToDoを追加</a>
</div>

<div class="todo-preview">
  <h3>期限が近いWantToDo</h3>
  {% if upcoming %}
    <ul class="todo-list">
      {% for w in upcoming %}
        <li class="todo-item {{ w.difficulty|diff_row_class }}">
          <div class="todo-main position-relative">
            {# 行全体クリックで詳細へ #}
            <a href="{% url 'todo_app:detail' w.id %}" class="stretched-link"></a>

            <div class="todo-title">
              {{ w.title }}
              <span class="badge-diff {{ w.difficulty|diff_badge_class }}">
                {{ w.get_difficulty_display }}
              </span>
            </div>

            <div class="todo-sub">
              <span class="todo-deadline">
                {% if w.deadline %}期限：{{ w.deadline }}{% else %}期限未設定{% endif %}
              </span>
              {% if w.category %}<span class="todo-cat"> / {{ w.get_category_display }}</span>{% endif %}
            </div>

            {% if w.memo %}<div class="todo-memo">{{ w.memo }}</div>{% endif %}
          </div>

          <div class="todo-actions">
            <form method="post" action="{% url 'todo_app:complete_want' w.id %}">
              {% csrf_token %}
              <input type="hidden" name="next" value="{% url 'todo_app:home' %}">
              <button type="submit" class="btn-complete">完了</button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="signup-help" style="text-align:center">該当する未完了のWantToDoはありません。</p>
  {% endif %}
</div>

<div class="bottom-button">
  <a href="{% url 'todo_app:incomplete_list' %}" class="btn btn-secondary">未完了WantToDo一覧へ</a>
</div>
{% endblock %}