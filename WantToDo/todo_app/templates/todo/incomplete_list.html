{% extends 'todo/base.html' %}
{% load static %}
{% load todo_extras %}
{% block extra_css %}<link rel="stylesheet" href="{% static 'todo/home.css' %}">{% endblock %}

{% block content %}
  <div class="filter-box" style="max-width:900px;">
    <h3 style="text-align:center; margin-bottom:16px;">未完了のWantToDo</h3>

    {% if wants %}
      <ul class="todo-list">
        {% for w in page_obj.object_list %}
          <li class="todo-item {{ w.difficulty|diff_row_class }}">
            <div class="todo-main">
              {# 行全体をクリックで詳細へ #}
              <a href="{% url 'todo_app:detail' w.id %}" class="stretched-link"></a>

              <div class="todo-title">{{ w.title }}</div>
              <div class="todo-sub">
                <span class="badge-diff {{ w.difficulty|diff_badge_class }}">
                  {{ w.get_difficulty_display }}
                </span>
                <span class="todo-deadline">
                  {% if w.deadline %}期限：{{ w.deadline }}{% else %}期限未設定{% endif %}
                </span>
                {% if w.category %}<span class="todo-cat"> / {{ w.get_category_display }}</span>{% endif %}
              </div>
              {% if w.memo %}<div class="todo-memo">{{ w.memo }}</div>{% endif %}
            </div>

            <div class="todo-actions">
              <form method="post" action="{% url 'todo_app:complete_want' w.id %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{% url 'todo_app:incomplete_list' %}?page={{ page_obj.number }}">
                <button type="submit" class="btn-complete">完了</button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>

      {% if page_obj.has_other_pages %}
        <nav aria-label="Page navigation" class="mt-4">
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
              <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
              </li>
            {% endfor %}

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            {% endif %}
          </ul>
        </nav>
      {% endif %}
    {% else %}
      <p class="signup-help" style="text-align:center">未完了の WantToDo はありません。</p>
    {% endif %}


  <div class="bottom-button">
    <a href="{% url 'todo_app:add_want' %}" class="btn btn-gray">新たなWantToDoを追加</a>
  </div>

  </div>
{% endblock %}
